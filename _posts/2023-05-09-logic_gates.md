---
title: CO1. 逻辑门
author: GalaxyRover59
date: 2023-05-09 10:00:00 +0800
category: [计算机组成原理]
tags: [hardware]
math: true
layout: post
---


每一个数字设备，无论是个人电脑、手机，还是网络路由器，都是基于一组旨在存储和处理二进制信息的芯片。虽然这些芯片有不同的形状和形式，但它们都是由相同的构件组成的：基本逻辑门。这些门可以使用许多不同的硬件技术进行物理实现，但它们的逻辑行为或抽象在所有实现中都是一致的。

在本章中，我们从一个原始的逻辑门------Nand开始，并从中构建我们将需要的所有其他逻辑门。特别地，我们将构建Not、And、Or和Xor门，以及两个名为多路复用器(multiplexer)和非多路复用器(demultiplexer)的门（所有这些门的功能将在本章稍后部分描述）。由于我们的目标是设计以16位值进行操作的计算机，因此我们还将构建16位版本的基本门，比如Not16、And16，等等。其结果将是一套相当标准的逻辑门，它稍后将用于构建我们的计算机的处理和存储芯片。这将分别在第2章和第3章中完成。

本章从设计和实现逻辑门所需的最小集合的理论概念和实用工具开始。特别地，我们引入了布尔代数和布尔函数，并展示了如何通过逻辑门来实现布尔函数。然后，我们描述了如何使用硬件描述语言(Hardware
Description Language,
HDL)来实现逻辑门，以及如何使用硬件模拟器来测试这些设计。

## 1. 布尔代数

布尔函数是一个对二进制输入进行操作并返回二进制输出的函数。由于计算机硬件是基于表示和操作二进制值的，因此布尔函数在硬件架构的规范、分析和优化中起着核心作用。

#### 布尔操作符

三个基本的布尔操作符为与、或、非，其真值表如图所示![basicBoolFunc](/images/basicBoolFunc.png "基本布尔操作真值表")

给出了可以在两个变量上定义的所有可能的布尔函数的定义，以及它们的通用名称。这些函数是通过枚举两个二进制变量的所有可能的组合来系统地构造函数。每个操作符都有一个传统的名称，它试图描述其底层语义。例如，Nand运算符的名称是\"Not-And\"的缩写，因为我们发现Nand(x，y)等同于Not(And(x，y))。Xor运算符是异或(exclusive
or)的缩写，仅在其两个变量中只有一个为1时，值为1。Nor门的名字来源于\"Not-Or\"。

![枚举布尔操作](/images/BoolFunc.png "两个布尔变量的所有布尔函数。一般来说，n个布尔变量所有可能的布尔函数个数为2^(2^n)")

让我们思考这样一个问题：是什么使And，Or，和Not比其他任何一个布尔运算符子集更有趣或更基本？一个更深的答案是，逻辑运算符的各种子集都可以用来表达任何布尔函数，And，Or，Not就是这样一个子集。事实上，这三个基本操作符中的任何一个都可以用另一个操作符------Nand来表示。亦即，任何布尔函数都可以只使用Nand门来实现。从下式可以清楚地看到这一点

$$\begin{aligned} 
    \mathrm{Not}\ x &= x\ \mathrm{Nand}\ x \\
    x\ \mathrm{And}\ y &= \mathrm{Not}\ (x\ \mathrm{Nand}\ y) = (x\ \mathrm{Nand}\ y)\ \mathrm{Nand}\ (x\ \mathrm{Nand}\ y) \\
    x\ \mathrm{Or}\ y &= \mathrm{Not}\ (\mathrm{Not}\ x\ \mathrm{And}\ \mathrm{Not}\ y) = (x\ \mathrm{Nand}\ x)\ \mathrm{Nand}\ (y\ \mathrm{Nand}\ y) \\
\end{aligned}$$

将上述方程反向运用，即布尔表达式的简化具有重要的实际意义。例如，原始的布尔表达式Not (Not ($x$) And Not ($x$ Or $y$))可以使用五个逻辑门在硬件中实现，而简化的表达式($x$ Or $y$)可以使用单个逻辑门实现。这两个表达式都提供了相同的功能，但后者在成本、能量和计算速度方面是其效率的五倍。

将布尔表达式简化为更简单的表达式是一种需要经验和洞察力的艺术。有各种简化工具和技术是可用的，但这个问题仍然具有挑战性。一般来说，将一个布尔表达式简化为其最简单的形式是一个NP-hard问题。

## 2. 门电路

门是一种实现一个简单的布尔函数的物理设备。虽然今天大多数数字计算机使用电力来实现门和表示二进制数据，但任何具有切换和传导能力的替代技术都可以使用。近年来，许多布尔函数的硬件实现被发明出来，包括磁性、光学、生物、液压、气动、基于量子，甚至基于多米诺骨牌的机制。今天，通常用在硅上蚀刻制造的晶体管作为门，封装成芯片。

门电路的物理实现交由电气工程师进行，因此，像下图中所示的原始门可以看作是以某种方式实现基本逻辑操作的黑箱设备（若想进一步了解其具体的物理实现，参考附录门电路部分）。

![三个基本逻辑门的示意图](/images/LogicGates.png)

复杂的布尔函数可以用三种基本门之间的组合、连接来实现，例如Xor门.

![Xor门的接口和真值表（左）与一种可能的实现方式（右）](/images/Xor.png "Xor门")

上图告诉了我们两件事，一是我们可以看到，任何给定的逻辑门都可以从两个不同的角度来看待：内部和外部。上图右侧给出了门的内部架构或实现，而左侧显示了门的接口和真值表，即它的输入和输出引脚以及它暴露给外部世界的行为。内部视图只与门电路的设计者相关，然而，对于那些希望将门作为一个抽象的、现成的组件，而不注意其实现的设计师来说，外部视图就是足够的细节级别了。

二是注意到任何给定门的接口都是唯一的：只有一种方法来指定它，而这通常是使用真值表、布尔表达式或口头规范来完成的。然而，这个接口可以通过许多不同的方式来实现，而且有些方式将比其他的更加优雅和高效。例如，上图所示的是一种可能的Xor的实现，并且有更有效的方法来实现Xor，即使用更少的逻辑门和更少的门间连接。因此，从功能的角度来看，逻辑设计的基本要求是：以某种方式连接门来实现其声明的接口。从效率的角度来看，一般的规则是尽量使用尽可能少的门，因为更少的门意味着更少的成本、更少的能量和更快的计算。

## 3. 硬件模拟

打算实现各种逻辑电路时，我们首先想到的方法是使用最基本的门搭起一个电路，用焊锡焊好内部的引脚与导线的连接，留出外部引脚，最后将其封装成一个"黑盒子"。这种想法在电路比较简单时尚可接受，然而随着电路愈加复杂，最终会在测试与修改时遇到问题：难道每一次都要先流片一次，然后拿去测试，碰到问题再拆开电路修改其物理结构？每次流片都有较大的成本，消耗不少时间，如果都要等流片之后才做测试，才能发现问题，然后修改，这在成本与时间上的代价是极其昂贵的。

还好，如今硬件设计师们已经可以不用徒手制造任何东西了，而是使用一种被称为硬件描述语言(Hardware Description Language, HDL)的方法来设计芯片架构。设计者通过编写一个HDL程序来指定芯片逻辑，然后再用特殊的软件------被称为硬件模拟器------在计算机上模拟进行一系列严格的测试，并与设想的输出做比较。

除了测试芯片的正确性外，硬件设计者通常还会对各种参数感兴趣，如计算速度、能耗和总体成本。所有这些参数都可以通过硬件模拟器进行模拟和量化，帮助设计者优化设计，直到模拟芯片提供所需的成本和性能水平。

因此，使用HDL，可以在物理生产之前完全计划、调试和优化整个芯片。当模拟芯片的性能满足订购它的客户时，HDL程序的优化版本可以作为蓝图，在硅上刻出相应的物理芯片。芯片设计过程中的最后一步------从优化的HDL程序到大规模生产，通常会外包给专门从事芯片制造的公司。

### HDL与硬件模拟器

关于这部分内容，请参阅参考文献[^1]或Coursera网站上[相关课程内容](https://www.coursera.org/learn/build-a-computer)。

[^1]:Noam Nisan and Shimon Schocken. *The elements of computing systems: building a modern computer from first principles.* MIT press, 2021.

## 4. 常用逻辑门

常用的逻辑门除了与、或、非、异或门外，还有数据选择器(Multiplexer)与数据分配器(Demultiplexer).

- ### 数据选择器

数据选择器是一个三输入门。其有两个数据输入位------a和b，以及一个选择位------sel，用于选择输出a或b的值。

![数据选择器](/images/Multiplexer.png "数据选择器")

- ### 数据分配器

数据分配器执行与数据选择器相反的功能：它接受单个输入值，并根据sel的值将其输出到a与b中的某一路，另一个输出则被设置为0。

![数据分配器](/images/Demultiplexer.png "数据分配器")

- ### 多位逻辑门

计算机硬件通常被设计为处理多位值------例如，计算两个给定的16位输入的与。一般而言，我们可以将多个1位的逻辑门组合成对应的多位逻辑门。

在HDL程序中，对多位值的表示和单位值相同，不过多位值可以通过索引得到单个位上的值。不过需要注意的是，这些位的索引是从右到左的，即最右边的位是第0位，最左边的位是第15位（在16位设置中）。

- ### 多路逻辑门

有一个或两个输入的逻辑门可以自然地到有多个输入的版本，即为对应的多路逻辑门，例如计算8个输入bit的或，16个输入bit的与，等等。

如果将门的输入由1位再扩展到多位，便得到了多路多位逻辑门。
