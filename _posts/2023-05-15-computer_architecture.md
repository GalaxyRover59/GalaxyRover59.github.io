---
title: CO4. 计算机体系结构
author: GalaxyRover59
date: 2023-05-15 10:10:00 +0800
category: [计算机科学, 计算机组成原理]
tags: [hardware, nand2tetris]
img_path: /images/computer_organization/
layout: post
---


这一章会将之前章节中构建的硬件，集成到一个通用的计算机系统中，能够运行特定的机器语言编写的程序。这个特定的计算机，称为Hack[^1]. Hack虽然简单，但功能也足够丰富，可以用来说明任何通用计算机的关键操作原理和硬件元素。因此，构建它将可以亲身了解现代计算机是如何工作的，以及它们是如何构建的。

[^1]:Noam Nisan and Shimon Schocken. *The elements of computing systems: building a modern computer from first principles.* MIT press, 2021.

## 1. 冯·诺伊曼架构

![von Neumann computer architecture](vonNeumannArchitecture.png "通用的冯·诺伊曼计算机架构")

上图所示的冯·诺伊曼架构基于中央处理单元(Central Processing Unit, CPU)，从输入设备接收数据，与存储设备交互，并将数据发送到输出设备。这种架构的核心在于存储程序的概念：计算机的内存不仅存储计算机所操作的数据，还存储告诉计算机该做什么的指令。

## 2. 内存

计算机的内存可以从物理和逻辑两个角度进行讨论。在物理上，内存是由许多可寻址的、固定大小的寄存器组成的线性序列，每个寄存器都有一个唯一的地址和一个值。从逻辑上讲，这个地址空间有两个目的：存储数据和存储指令。“指令”和“数据”的表现方式完全相同——作为特定长度的二进制数。

专用于存储数据的内存区域称为数据内存，专用于存储指令的内存区域称为指令内存。在冯·诺伊曼架构的一些变体中，数据内存和指令内存根据需要，可以在相同的物理地址空间内动态分配和管理。在其他变体中，数据内存和指令内存被保存在两个物理上独立的内存区域中，每个内存区域都有自己不同的地址空间。

- ### 数据内存

Hack的数据内存是由三个16位寄存器部件封装组成：RAM16K（16K寄存器，用作通用数据存储）、Screen（8K寄存器，用作屏幕内存映射）和Keyboard（内置寄存器，用作键盘内存映射）。

![data memory](DataMemory.png "数据内存")

- ### 指令内存

在Hack中，指令内存可以实现为预加载所需程序的只读存储器(Read-Only Memory, ROM)芯片。这些程序需要事先由相应的汇编器转换为二进制码，然后存入ROM中。

![instruction memory](InstructionMemory.png "指令内存")

## 3. 输入/输出

Hack可以连接两个外围设备：一个屏幕和键盘。这两种设备都通过被称为内存映射的指定内存区域与计算机平台进行交互。比如可以通过在屏幕内存映射的指定内存段中写入16位数值来在屏幕上绘制图像。类似地，通过探测被称为键盘内存映射的16位内存寄存器，可以确定目前在键盘上按下的是哪个键。

屏幕内存映射和键盘内存映射通过计算机外部的外围刷新逻辑，每秒多次不断更新。因此，当屏幕内存映射中的一个或多个位发生变化时，该变化会立即反映在物理屏幕上。同样地，当在物理键盘上按下一个键时，所按下的键的字符代码会立即出现在键盘内存映射中。

## 4. 中央处理器

Hack平台的中央处理器(Central Processing Unit, CPU)需要具备以下功能：(1)执行给定的Hack指令；(2)确定下一步应该提取和执行哪条指令。

为了做到这一点，我们将使用逻辑门来解码当前指令。之后根据指令使用算术逻辑单元(ALU)来计算指定的函数。接下来在一组寄存器中，根据指令确定结果是否存储、存储于哪些寄存器中。最后通过程序计数器，跟踪下一条应该被取出并执行的指令。

由于所有的底层构建块（ALU、寄存器、PC和基本逻辑门）都已经在前面的章节中构建好了，所以我们现在面临的关键问题是如何连接这些芯片部件以获得具有所需功能的CPU。下图说明了一种可能的配置。

![CPU](CPUCircuit.png "中央处理器")

## 5. 计算机

最终，将上述所有部件芯片组合，即可得到设想的计算机平台了。

![Computer](computer.png "计算机")